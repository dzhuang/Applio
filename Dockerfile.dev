# 基于现有的镜像构建
FROM applio-applio:latest

# 设置工作目录
WORKDIR /app

# 确保环境变量正确指向虚拟环境
ENV PATH="/app/.venv/bin:$PATH"

# TTS 相关环境变量
ENV SRT_TTS_CACHE_SIZE_MB=512
ENV TTS_OUTPUT_CACHE_SIZE_MB=256
ENV ENABLE_AZURE_TTS_API=false
ENV DEFAULT_TTS_VOICE=zh-CN-YunxiNeural

# 复制修改过的文件（目录级别）
COPY rvc/lib/tools/ /app/rvc/lib/tools/
COPY tabs/tts/ /app/tabs/tts/
COPY assets/i18n/languages/ /app/assets/i18n/languages/
COPY core.py /app/core.py
COPY requirements.txt /app/requirements.txt

# 安装新增加的依赖项
RUN pip install --no-cache-dir srt langdetect azure-cognitiveservices-speech pydub gtts

# 启动命令保持不变 (由基底镜像提供)
