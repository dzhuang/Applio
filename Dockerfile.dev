# 基于现有的镜像构建
FROM applio-applio:latest

# 设置工作目录
WORKDIR /app

# 确保环境变量正确指向虚拟环境
ENV PATH="/app/.venv/bin:$PATH"

# TTS缓存大小限制 (MB)，可在docker-compose中覆盖
ENV SRT_TTS_CACHE_SIZE_MB=512

# 复制新增加的工具文件、修改过的核心逻辑和UI代码
COPY rvc/lib/tools/srt_utils.py /app/rvc/lib/tools/srt_utils.py
COPY rvc/lib/tools/tts.py /app/rvc/lib/tools/tts.py
COPY rvc/lib/tools/tts_cache.py /app/rvc/lib/tools/tts_cache.py
COPY core.py /app/core.py
COPY tabs/tts/tts.py /app/tabs/tts/tts.py
COPY requirements.txt /app/requirements.txt

# 安装新增加的依赖项
RUN pip install --no-cache-dir srt langdetect azure-cognitiveservices-speech pydub gtts

# 启动命令保持不变 (由基底镜像提供)
